/*! random-movie-trailer 2017-10-19 */

const fs=require("fs"),path=require("path"),moviesModel=path.join(__dirname,"../models/movies.json"),moviesScraped=path.join(__dirname,"../models/movies2.json"),readMovies1=()=>new Promise((e,r)=>{fs.readFile(moviesModel,"utf8",(i,s)=>{i&&r(i);let o=JSON.parse(s);e(o)})}),readMovies2=e=>new Promise((r,i)=>{fs.readFile(moviesScraped,"utf8",(s,o)=>{s&&i(s),o=JSON.parse(o),r([e,o])})}),merge=(e,r)=>{let i=[];return e=e instanceof Array?e:[],r=r instanceof Array?r:[],e.concat(r).filter(e=>-1===i.indexOf(e.title)&&(i.push(e.title),!0))},write=e=>{fs.writeFile(moviesModel,e,e=>{if(e)throw e;console.log("File created!")})};new Promise((e,r)=>{fs.readFile(moviesModel,"utf8",(i,s)=>{i&&r(i);let o=JSON.parse(s);e(o)})}).then(e=>new Promise((r,i)=>{fs.readFile(moviesScraped,"utf8",(s,o)=>{s&&i(s),o=JSON.parse(o),r([e,o])})})).catch(e=>console.error(e)).then(e=>{let r=JSON.stringify(merge(e[0],e[1]));write(r)});